<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <div th:replace="~{fragments/links::css}"></div>
    <link rel="stylesheet" href="/css/blog.css">
</head>
<body>
<div class="container">
    <div th:replace="~{fragments/navbar::navbar}"></div>
    <div th:replace="~{fragments/modal-login::modal_login}"></div>
    <div th:replace="~{fragments/breadcrumb::breadcrumb('Blog')}"></div>
    <div th:if="${blog != null}">
        <h2 th:text="${blog.getTitle()}"></h2>
        <div class="d-flex justify-content-between align-items-start position-relative">
            <div class="left" style="max-width: 950px; margin-right: 50px;">
                <div style="width: 900px; height: 400px; background-color: #717171"></div>
                <div th:each="p : ${blog.paragraphs}" class="mt-3">
                    <p th:text="${p.paragraph}"></p>
                    <div class="mb-3 mt-5"></div>
                </div>
                <div class="position-relative mb-3">
                    <div class="d-flex counter">
                        <div class="comment-count d-flex align-items-center"><span class="comment-count-icon"></span>
                            <span th:text="${comment_count}" class="comment-count-text"></span> Comments</div>
                        <div class="like-count d-flex align-items-center">
                            <form id="like" th:method="POST" th:action="@{'/blogs/' + ${blog.id} + '/like'}">
                                <button type="submit" class="like-count-icon"></button>
                            </form>
                            <span th:text="${like_count}"
                                  class="like-count-text" id="amount_likes"></span> Likes
                            <div id="updatedLike" class="d-none" th:text="${likes}"></div>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="comments mt-5" th:if="${comment_count != null}">
                    <strong>Comments</strong>
                    <div class="mt-3 comments-box" th:each="c : ${blog.comments}">
                        <strong>User</strong>
                        <p class="comment-text" th:text="${c.comment}"></p>
                    </div>
                </div>
            </div>
            <div class="right" style="position: absolute; right: 200px">
                <strong class="fw-bold mb-3">Categories</strong>
                <div th:each="category : ${blog.categories}">
                    <div th:text="${category.name}"></div>
                    <div class="mt-3 mb-3"></div>
                </div>
                <strong>Tags</strong>
                <div th:each="t : ${blog.tags}" class="mt-3 d-flex align-items-start flex-wrap">
                        <span style="margin-right: 5px;" class="tag"
                              th:text="${t.tag}"></span>
                </div>
            </div>
        </div>
    </div>
</div>


<div th:replace="~{fragments/links::js}"></div>
<script th:inline="javascript">
    $(document).ready(function() {
        $('#like').submit(function(event) {
            event.preventDefault();
            var formData = $(this).serialize();

            $.ajax({
                type: 'POST',
                url: $(this).attr('action'),
                data: formData,
                success: function() {
                    let amount = document.getElementById('amount_likes')
                    let updated = document.getElementById('updatedLike')
                    amount.innerText = updated.textContent
                  },
                error: function(error) {
                    console.error('Ошибка при отправке лайка:', error);
                }
            });
            }
        )})
</script>
</body>
</html>